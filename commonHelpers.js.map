{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst searchForm = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\nconst loaderEl = document.querySelector('.loader');\nconst loadMoreBtn = document.querySelector('[data-action=\"load-more\"]');\nconst messageFinishGallery = document.querySelector('.finish-loader');\n\nconst lightboxEl = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\nconst queryParams = {\n  query: '',\n  page: 1,\n  maxPage: 0,\n  pageSize: 40,\n};\nsearchForm.addEventListener('submit', handleSerch);\nloadMoreBtn.addEventListener('click', handleLoadMore);\nasync function handleSerch(event) {\n  event.preventDefault();\n  loaderEl.style.display = 'block';\n  loadMoreBtn.classList.add('is-hidden');\n  messageFinishGallery.classList.add('is-hidden');\n  gallery.innerHTML = '';\n  const form = event.currentTarget;\n  queryParams.query = form.elements.query.value.trim();\n  queryParams.page = 1;\n\n  if (!queryParams.query) {\n    loaderEl.style.display = 'none';\n    return iziToast.error({\n      message: 'Enter a query value, please',\n      position: 'topRight',\n      backgroundColor: 'green',\n      icon: 'none',\n    });\n  }\n\n  try {\n    const resp = await fetchImages(queryParams.query);\n    if (resp.data.hits.length === 0) {\n      return iziToast.error({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight',\n        backgroundColor: 'red',\n        icon: 'none',\n      });\n    } else {\n      createMarkup(resp.data.hits);\n      queryParams.maxPage = Math.ceil(\n        resp.data.totalHits / queryParams.pageSize\n      );\n    }\n    if (queryParams.page === queryParams.maxPage) {\n      messageFinishGallery.classList.remove('is-hidden');\n\n      loadMoreBtn.classList.add('is-hidden');\n    } else {\n      loadMoreBtn.classList.remove('is-hidden');\n    }\n    form.reset();\n  } catch (err) {\n    iziToast.error({\n      message: 'Oops, server connection error!',\n      position: 'topRight',\n      backgroundColor: 'red',\n      icon: 'none',\n    });\n  } finally {\n    loaderEl.style.display = 'none';\n  }\n}\n\nfunction fetchImages(query) {\n  const BASE_URL = 'https://pixabay.com/api';\n  const API_KEY = '41900218-778e908913d1efd90b8f97d56';\n\n  const searchParams = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n    per_page: queryParams.pageSize,\n    page: queryParams.page,\n  });\n  return axios.get(`${BASE_URL}/?${searchParams}`);\n}\n\nasync function handleLoadMore(event) {\n  queryParams.page += 1;\n  loaderEl.style.display = 'block';\n  loadMoreBtn.classList.add('is-hidden');\n\n  try {\n    const respNext = await fetchImages(queryParams.query);\n    createMarkup(respNext.data.hits);\n\n    if (queryParams.page === queryParams.maxPage) {\n      loadMoreBtn.classList.add('is-hidden');\n      messageFinishGallery.classList.remove('is-hidden');\n    } else {\n      loadMoreBtn.classList.remove('is-hidden');\n      const galleryCard = document\n        .querySelector('.gallery-card')\n        .getBoundingClientRect();\n      window.scrollBy(0, galleryCard.height * 2);\n    }\n  } catch (err) {\n    iziToast.error({\n      message: 'Oops, server connection error!',\n      position: 'topRight',\n      backgroundColor: 'red',\n      icon: 'none',\n    });\n  } finally {\n    loaderEl.style.display = 'none';\n  }\n}\n\nfunction createMarkup(arr) {\n  const markup = arr\n    .map(\n      ({\n        largeImageURL,\n        webformatURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) =>\n        `<li class=\"gallery-card\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n            <img \n                class=\"gallery-image\"\n                    src=\"${webformatURL}\"\n                    alt=\"${tags}\"/>\n        </a>\n        <div class=\"titles-box\">\n            <div class=\"title-element\">\n                <p class=\"title-text\">Likes:</p>\n                <p class=\"title-value\">${likes} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Views:</p>\n                <p class=\"title-value\">${views} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Comments:</p>\n                <p class=\"title-value\">${comments} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Downloads:</p>\n                <p class=\"title-value\">${downloads} </p>\n            </div>\n        </div>\n    </li>`\n    )\n    .join('');\n  gallery.insertAdjacentHTML('beforeend', markup);\n  lightboxEl.refresh();\n}\n"],"names":["searchForm","gallery","loaderEl","loadMoreBtn","messageFinishGallery","lightboxEl","SimpleLightbox","queryParams","handleSerch","handleLoadMore","event","form","iziToast","resp","fetchImages","createMarkup","query","BASE_URL","API_KEY","searchParams","axios","respNext","galleryCard","arr","markup","largeImageURL","webformatURL","tags","likes","views","comments","downloads"],"mappings":"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"}